# Learned Lessons & Development Mistakes

**Purpose:** Track lessons learned and mistakes made during development to improve AI agent performance and avoid repeating errors. Keep entries concise and AI agent-friendly.
**Note:** Always ask which lessons to include before editing and keep it very consice and sarcastic.

---

## Development Workflow

### ‚ùå **PowerShell Command Syntax**

- **Problem:** Used `&&` operator in PowerShell (not supported)
- **Correct:** Use separate commands or `;` separator
- **Lesson:** Always use Windows-compatible commands

### ‚ùå **Type Assertions & User Preferences**

- **Problem:** Used `as` and `any` when user prefers Zod
- **User Preference:** "i prefer zod when suitable instead"
- **Lesson:** Use Zod for runtime validation, avoid `as` and `any`

### ‚úÖ **Incremental Refactoring**

- **Approach:** Broke down large refactoring into smaller, testable steps
- **Lesson:** Incremental changes reduce risk and improve debugging

### ‚ùå **Unnecessary Comments**

- **Problem:** Added verbose comments that don't add real value
- **User Preference:** "avoid comments unless really needed and adding real value"
- **Lesson:** Only comment non-obvious logic, let code speak for itself

### üö® **NEVER Touch Generated Files**

- **Problem:** Manually editing Supabase-generated types
- **Rule:** `GENERATED_database.types.ts` is auto-generated by Supabase CLI
- **Setup:** `npm run types:generate` generates and formats the file automatically
- **Lesson:** Only modify files you create, never touch generated files - they'll be overwritten

### ‚ùå **Don't Run Dev Servers**

- **Problem:** Tried to run dev servers automatically
- **Rule:** Always assume servers are running
- **Lesson:** Don't run dev servers - if they're not running, ask the user

### üö® **NEVER Skip Tests Without Confirmation**

- **Problem:** Skipped tests when stuck instead of asking user
- **Rule:** Always ask before skipping tests - user may have preferences
- **Lesson:** When stuck, ask user how to proceed rather than skipping tests

### üö® **NEVER Run Destructive Commands Without Explicit Permission**

- **Problem:** Ran `npm run db:migrate:reset` without asking user first
- **Rule:** ALWAYS ask before running ANY destructive commands, especially database operations
- **Critical:** Supabase commands like `db reset`, `db push`, `migration reset` can destroy data
- **Lesson:** When user can't login, ask what they want to do - don't assume database reset is needed

### üîç **Debug RLS Issues with Detailed Error Messages**

- **Problem:** Generic error messages made debugging RLS policies difficult
- **Rule:** Always improve error handling to show actual error messages for debugging
- **Lesson:** The error "Failed to update user status" was actually "new row violates row-level security policy for table 'audit_logs'"
- **Fix:** Enhanced error logging in auth middleware and admin router to show specific Supabase errors

### üõ†Ô∏è **Use Playwright for Real-Time Debugging**

- **Problem:** Backend logs weren't accessible for debugging authentication issues
- **Rule:** Use browser automation tools to debug frontend-backend interactions
- **Lesson:** Playwright can simulate real user actions and show network requests/errors
- **Fix:** Used Playwright to login as admin and test verification process step-by-step

### üß™ **Test Strategy Preferences**

- **User Preference:** "always prefer playwright tests for ui and interaction. and unit tests for backend and non-react important functions"
- **Rule:**
  - **Playwright E2E** for UI components, user interactions, and full user flows
  - **Unit tests** for backend API endpoints, utility functions, and non-React business logic
- **Lesson:** Don't waste time on React component unit tests when Playwright covers real user behavior better
- **Focus:** Backend validation, auth logic, database operations, and critical utility functions

### ‚ö° **Run Failed Tests Only When Fixing**

- **Problem:** Running all tests repeatedly when only fixing specific failures
- **Rule:** When fixing or writing new tests, run only failed tests to save time
- **Command:** `npm test -- --grep "failing test name"` or `npm test -- specific-file.spec.ts`
- **Lesson:** Don't waste time running 15 passing tests when you only need to fix 1 failing test

### üßπ **Remove Fake Tests, Keep Meaningful Differences**

- **Problem:** Tests that test nothing or duplicate functionality without meaningful differences
- **Rule:** Only remove tests that are clearly fake (admit they don't test what they claim)
- **Examples:** Tests that "would require clean database" but don't actually test empty state
- **Lesson:** Be conservative - if tests have different contexts, scenarios, or assertions, keep them
- **Result:** Removed 2 fake tests, kept 33 meaningful tests with real coverage

### üéØ **Fix Playwright Strict Mode Violations**

- **Problem:** `locator.click: Error: strict mode violation: locator resolved to X elements`
- **Cause:** Generic selectors like `text=Pending` match multiple elements in tables/lists
- **Fix:** Use specific selectors like `[role="option"]:has-text("Pending")` for dropdowns
- **Lesson:** Always target the specific element you want, not generic text that appears multiple times
- **Example:** Changed `text=Pending` to `[role="option"]:has-text("Pending")` for dropdown options
